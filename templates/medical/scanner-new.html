{% extends 'medical/base.html' %}
{% load static %}

{% block title %}Scanner Intelligent{% endblock %}

{% block extra_css %}
<link href="{% static 'css/scanner.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="scanner-container">
    <!-- Header -->
    <div class="scanner-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="scanner-title">
                        <i class="fas fa-camera me-3"></i>Scanner Intelligent
                    </h1>
                    <p class="scanner-subtitle">Numérisez et traitez vos documents médicaux avec l'IA</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="scanner-stats">
                        <span class="stat-item">
                            <i class="fas fa-file-medical"></i>
                            <span id="totalScans">0</span> Documents
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions principales -->
    <div class="scanner-actions">
        <div class="container">
            <div class="row g-3">
                <div class="col-md-4">
                    <button class="scanner-btn btn-primary" id="startScanBtn">
                        <i class="fas fa-camera"></i>
                        <span>Démarrer Scan</span>
                        <small>Caméra ou simulation</small>
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="scanner-btn btn-success" id="uploadBtn">
                        <i class="fas fa-upload"></i>
                        <span>Importer Fichier</span>
                        <small>Image ou PDF</small>
                    </button>
                </div>
                <div class="col-md-4">
                    <button class="scanner-btn btn-info" id="batchBtn">
                        <i class="fas fa-layer-group"></i>
                        <span>Scan en Lot</span>
                        <small>Plusieurs documents</small>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Zone de prévisualisation -->
    <div class="scanner-preview">
        <div class="container">
            <div id="scanPreview" class="scan-preview-container">
                <div class="scanner-placeholder">
                    <i class="fas fa-camera"></i>
                    <h4>Prêt à Scanner</h4>
                    <p>Choisissez une option ci-dessus pour commencer</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Étapes de traitement -->
    <div id="processingSteps" class="processing-steps" style="display: none;">
        <div class="container">
            <h5 class="text-center mb-4">
                <i class="fas fa-cogs me-2"></i>Traitement en cours...
            </h5>
            <div class="row g-3">
                <div class="col-md-2">
                    <div class="step-item" id="step1">
                        <div class="step-icon">
                            <i class="fas fa-camera"></i>
                        </div>
                        <div class="step-content">
                            <h6>Capture</h6>
                            <div class="step-status">
                                <span class="badge bg-secondary">En attente</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="step-item" id="step2">
                        <div class="step-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="step-content">
                            <h6>Analyse</h6>
                            <div class="step-status">
                                <span class="badge bg-secondary">En attente</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="step-item" id="step3">
                        <div class="step-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="step-content">
                            <h6>IA</h6>
                            <div class="step-status">
                                <span class="badge bg-secondary">En attente</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="step-item" id="step4">
                        <div class="step-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="step-content">
                            <h6>OCR</h6>
                            <div class="step-status">
                                <span class="badge bg-secondary">En attente</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="step-item" id="step5">
                        <div class="step-icon">
                            <i class="fas fa-tags"></i>
                        </div>
                        <div class="step-content">
                            <h6>Classification</h6>
                            <div class="step-status">
                                <span class="badge bg-secondary">En attente</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="step-item" id="step6">
                        <div class="step-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="step-content">
                            <h6>Finalisation</h6>
                            <div class="step-status">
                                <span class="badge bg-secondary">En attente</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistiques et scans récents -->
    <div class="scanner-stats-section">
        <div class="container">
            <div class="row g-4">
                <!-- Statistiques -->
                <div class="col-md-8">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon bg-primary">
                                <i class="fas fa-file-medical"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="totalDocuments">0</h3>
                                <p>Documents scannés</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-success">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="processedToday">0</h3>
                                <p>Traités aujourd'hui</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-warning">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="avgProcessingTime">0s</h3>
                                <p>Temps moyen</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-info">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="aiAccuracy">98%</h3>
                                <p>Précision IA</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scans récents -->
                <div class="col-md-4">
                    <div class="recent-scans">
                        <h5>
                            <i class="fas fa-history me-2"></i>Scans Récents
                        </h5>
                        <div class="scan-list">
                            <div class="scan-item">
                                <div class="scan-icon">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="scan-details">
                                    <h6>Rapport Radiologie</h6>
                                    <small>Il y a 2 minutes</small>
                                </div>
                                <div class="scan-actions">
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewScannedReport(1)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-success" onclick="downloadScannedReport(1)">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="scan-item">
                                <div class="scan-icon">
                                    <i class="fas fa-file-medical"></i>
                                </div>
                                <div class="scan-details">
                                    <h6>Prescription</h6>
                                    <small>Il y a 5 minutes</small>
                                </div>
                                <div class="scan-actions">
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewScannedReport(2)">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-success" onclick="downloadScannedReport(2)">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/scanner-modern.js' %}"></script>
<script>
// Fonctions de compatibilité pour l'ancien code
function startCamera() {
    if (window.scanner) {
        window.scanner.startScanning();
    }
}

function stopCamera() {
    if (window.scanner) {
        window.scanner.cancelScanning();
    }
}

function capturePhoto() {
    if (window.scanner) {
        window.scanner.captureDocument();
    }
}

function retakePhoto() {
    if (window.scanner) {
        window.scanner.retakePhoto();
    }
}

function submitDocument() {
    console.log('Utilisez le formulaire modal pour soumettre le document');
}

function switchCamera() {
    console.log('Changement de caméra non implémenté dans cette version');
}

function toggleFlash() {
    console.log('Flash non implémenté dans cette version');
}

function downloadScannedReport(reportId) {
    if (window.scanner) {
        window.scanner.downloadScannedReport(reportId);
    }
}

function viewScannedReport(reportId) {
    if (window.scanner) {
        window.scanner.viewScannedReport(reportId);
    }
}
</script>
{% endblock %}

